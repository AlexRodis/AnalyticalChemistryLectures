# Βελτιστοποίηση Αναλυτικών Μεθόδων

## Εισαγωγή

Όταν ανάπτυσουμε μια νέα αναλυτική μεθόδο αλλά και όταν προσαρμώζουμε μια υπάρχουσα σε άλλους τύπους δειγμάτων, πρέπει να κάνουμε *βελτιστοποίηση* της.
>**Βελτιστοποίηση:**
\
Ονομάζεται η εύρεση αυτών των τιμών των πειραματικών παραμέτρων της μεθόδου που δίνουν τα καλύτερα δυνατά αποτελέσμα (*μεγιστοποιούνε την απόκλιση*).

Απόκριση ονομάζεται μια συνάρτηση ποιοτικού μεγέθους που μας ενδιαφέρει να ελαχιστοποιήσουμε ή να μεγιστοποιήσουμε - ανάλογα με το μέγεθος. Παραδείγματα απόκρισης είναι:

* Σήμα(S) - Μεγιστοποιούμε
* Όριο Ανίχνευσης - Ελαχιστοποιούμε
* Εύρος Γραμμικής Περιοχής - Μεγιστοποίηση
* Διαχωριστηκότητα Γειτονικών Χρωματογραφικών Κορυφών - Μεγιστοποιούμε

Εναλλακτικά, μπορεί να είναι και γραμμικός συνδιασμός παραμέτρων. Για παράδειγμα αν έχουμε μια χρωματογραφική μέθοδο απορρόφησης μπορούμε να επιλέξουμε να μεγιστοποιήσουμε την απορρόφηση, λαμβάνοντας υπ' όψιν δύο παραμέτρους, το pH και την  θερμοκρασία $\theta$. Οπότε, ζητάμε να βελτιστοποιήσουμε (μεγιστοποιήσουμε) τη συνάρτιση απόκρισης:
$$
A=f(pH,\theta)
$$

Αν μπορούσαμε να μετρήσουμε απόκριση για κάθε ζεύγος δυνατών τιμών $(pH,\theta)$ θα λαμβάναμε την *επιφάνεια απόκρισης*. Το παγκόσμιο μέγιστο της είναι το βέλτιστο ζεύγος, δηλαδή το ζεύγος τιμών $(pH_{opt},\theta_{opt})$ για το οποίο είναι $A_{max}$.

Ζητάμε τεχνικές βελτιστοποίησης που οδηγούν σε αναρίχηση προς το ανώτατο σημείο. Ζητάμε να φτάσουμε σε αυτό το σημείο στο μικρότερο αριθμό βημάτων, αποφεύγοντας τον "εγκλωβισμό" σε τοπικά μέγιστα και ελάχιστα.
Οι τρεις κύριες τεχνικές στη διάθεση μας είναι:

* Αναζήτηση Σχηματομορφής
* Διαδοχική Μεταβολή Ενός Παράγοντα
* Πολυπαραμετρικό Simplex

## Aναζήτηση Σχηματομορφής

Είναι ουσιαστικά μια προσπάθεια συστηματικής "χαρτογράφησης" της επιφάνειας. Έχει όμως πολυπλοκότητας Ο($k^n$) για k τιμές ανά παράμετρο και ν παραμέτρους.
Εκτός από την μεγάλη πολυπλοκότητα για n>2 εμφανίζονται συχνά απότομες μεταβολές κάνοντας δύσκολη την εύρεση παγκοσμίων μεγίστων.

![pattern search]()

### Παραγοντικός Σχεδιασμός

Ο *παραγοντικός σχεδιασμός* βασίζεται σε προσεκτική επιλογή κρίσημων παραμέτρων και μείωση του αριθμού τους σε μόνο δύο. Τότε είναι Ο($2^n$). Με την ίδια λογική λειτουργεί και ο κλασματικός παραγοντικός σχεδιασμός με Ο($\frac {1}{2}2^n$) και απαιτεί κάποια γνώση για το πως επιδριύν οι παράμετροι στο μέγεθος.

## Διαδοχική Μεταβολή Ενός Παράγοντα Τη Φορά

Είναι η ποιό απλή περίπτωση. Κρατάμε σταθερές όλες τις παραμέτρους εκτός από μία. Κάνουμε k μετρήσεις και λαμβάνουμε τη βέλτιστη. Επαναλαμβάνουμε για τις υπόλοιπες n-1 παραμέτρους κρατόντας ως σταθερή τιμή, τη βέλτιστη την οποία βρήκαμε. Συνήθως επαναλαμβάνουμε r φορές όλη τη διαδικασία οπότε είναι Ο(rnk). Κύριο μειονέκτημα είναι οτι δε λαμβάνουμε υπ' όψιν τυχόν αλληλεπιδράσεις μεταξυ αυτών. Δηλαδή, η βελτιστοποιήση μιας παραμέτρου αλλάζη την τιμή μιας άλλης. Σε τέτοιες περιπτώσεις είνια πολύ δύσκολο να εντοπίσουμε την πραγματικά βέλτιστη τιμή των πειραματικών παραμέτρων.

![ΔΜΕΠτΦ Επιτυχημένη]()
![ΔΜΕΠτΦ Αποτυχημένη]()

## Μέθοδος Simplex

Οι παραπάνω μέθοδοι αν και απλοϊκές πάσχουν από υψηλή πολυπλοκότητα και ανικανότητα να διχειρηστούν μη-ανεξάρτητες παραμέτρους. Επομένως χρειαζόμαστε μια μέθοδο που επιτρέπει την ταυτόχρονη μεταβολή πολλαπλών παραμέτρων με ταχεία σύγκλιση προς το βέλτιστο. Η ποιό αποτελεσματική τέτοια μέθοδος είναι η *Simplex*. Αρχικά αναπτύχθηκε ως μια *αριθμητική μέθοδος* για την ελαχιστοποίηση ή την μεγιστοποίηση μαθηματικών συναρτήσεων. Έχει αποδηχθεί ως αξιόπιστη και αποτελεσματική μέθοδος βελτιστοποίησης με μηχανισμό ανάδρασης\[sic\] ως αποφεύγονται οι λανθασμένες κινήσεις. Ο συνηθέστερος αλγόριθμος είναι αυτός των Nelder-Mead.
Έστω n-διάστατος χώρος για n εξαιταζόμενες παραμέτρους. Τότε:
>**Simplex** ονομάζεται το γεωμετρικό σχήμα που ορίζεται από τα n+1 σημεία του χώρου. Κάθε σημείο ονομάζεται κορυφή (vertex).

Η κάθε κορυφή ορίζεται από ένα διάνυσμα μορφής $(x_1,x_2,x_3,[\;\dots],x_n)$. Επιλέγουμε (τυχαία αρχικά) n+1 παραμέτρους και μετράμε τις αντίστοιχες αποκρίσεις. Αυτά τα σημεία ορίζουν ένα αρχικό Simplex. Τότε καθορίζουμε:
* Τη χειρότερη απόκριση (W)
* Την αμέσως χειρότερη (N)
* Την καλύτερη (B)
* Το κεντροειδές (C) -χωρίς το W σημείο
* Το συμμετρικό του W ως προς το κεντροειδές

Το σημείο R δίνει ένα σύνολο τιμών που θα μετρήσουμε, παίρνοντας την αντίστοιχη απόκριση. Αν το R έχει καλύτερη απόκριση απ' ότι το 
N τότε απορρίπτεται το σημείο με την επόμενη χειρότερη απόκριση (Ν) και αντικαθίσταται με το συμμετρικό του ως προς το κεντροειδές της υπερεπιφάνειας *των υπολοίπων*.
Εκτελούμε την αντικατάσταση:
$$
W\rightarrow R\\
ή\\Ν\rightarrow R^{\prime}\\
C(\bar{x_{1i}},\bar{x_{2i}}, [\;\dots])
$$
Έτσι ολοκληρώνεται ένας κύκλος και έχουμε ένα νέο Simplex. Επαναλαμβάνουμε μεχρι κάποια συνθήκη τερματισμού, όπως μέγιστες επαναλήψεις ή μέχρι να συγκλίνει (βλ. παρακάτω).
Αν ένα σημείο διατηρηθεί μετά από n+1 διαδοχικούς κύκλους, τότε πριν απόρριψη και αντικατάσταση του χειρότερου, μετράμε ξανά την απόκριση τους για να βεβαιωθούμε για την ορθότητα του.
Αν κάποιο σημείο αντικατοπτρισμού R έχει για κάποια απ'τις συντεταγμένες του τιμές εκτός επιτρεπτών ορίων (πχ pH=-9) τότε απλά το απορρίπτουμε θέτωντας μια πολύ κακή απόκριση, όπως πχ S=-999.

Σε καθε κύκλο πέραν του πρώτου, μεταβολή της απόκρισης. Όταν αυτή η βελτίωση είναι μικρότερη από κάποιο προκαθορισμένο όριο τότε τερματίζουμε:
$$
\frac {S_n-S_{n-1}}{S_{n-1}}*100\% \le 1-2\%
$$

### Nelder-Mead Simplex

Το βασικό Simplex έχει το κύριο μειονέκτημα οτι χρησιμοποιεί Simplex με σταθερό εμβαδόν σε κάθε κύκλο, επομένως το "μήκος" των βημάτων καθορίζεται αποκλιστηκά από το αρχικό Simplex - το εμβαδόν και το αρχικό του σημείο -. Αυτό πρακτικά σημαίνει οτι για  αρκετά μεγάλα Simplexes μπορεί το βήμα να είναι τόσο μεγάλο ώστε να υπερπηδήσει το πραγματικό βέλτιστο. Γενικότερα για σταθερό βήμα είναι πρακτικός βέβαι το οτι δε θα προσγειωθούμε ακριβώς πάνω στο βέλτιστο σημείο, αλλά το πολύ κάποιο κοντά του.
Για μικρά βήματα αυξάνεται ο χρόνος που χρειαζόμαστε για να συγκλόνουμε στο σημείο και αυξάνονται οι πιθανότητες να εγκλωβιστούμε σε τυχόν τοπικά ακρότητα.
Αυτές οι δυσκολίες μπορούν να ξεπεραστούν εν μέρη αν κάνουμε δύο επαναλήψεις του αλγόριθμου, μία αρχική με σχετκά μεγάλα βήματα και ένα δεύτερο με μικρότερα βήματα, που ξεκινά εντός του τελευταίου Simplex της προηγούμενης εκτέλεσης (ώστε να είμαστε κοντά στο άριστο σημείο).
Οι Nelder και Mead τροποποιήσανε τον αλγόριθμο, ξεπερνόντας αυτά τα προβληματα. Ουσιαστικά σε κάθε κύκλο, δίνεται η δυνατότητα στο Simplex να συρρικνωθεί ή επεκταθεί, ανάλογα με τις ανάγκες. Δηλαδή:

* Κάνουμε αρχικά n+1 μετρήσεις για να φτιαχτεί το αρχικό Simplex.
* Ορίζουμε τα σημεία **Β,Ν,W,C** όπως άνω
* Έχουμε διάφορα σημεία ως πιθανούς υποψηφίου για την αντικατάσταση:
* 1. Ανάκλαση ( R=C+C-W )
  2. Επέκταση ( E=C+2(C-W) )
  3. θετική Σύμπτηξη: ( PC=C+$\frac 12$(C-W) )
  4. Αρνητική Σύμπτηξη: NC = ( C-$\frac12(C-W)$ )

![κινήσεις Simplex]()

![διάγραμμα ροής αποφάσεων Simplex]()
![ισοϋψείς simplex]()

### Βελτιστοποίηση Χρωματογραφικών Μεθόδων - Παράγοντας Απόκρισης

Ιδιαιτέρως, για χρωματογραφικές μεθόδους, μπορούμε να ορίζουμε ένα εξειδικευμένο μέγεθως απόκρισης προς βελτιστοποίηση, τον *τον παράγωντα απόκρισης*.
$$
CRF=\sum_i^n{R_i}+f_iN+f_2(t_A-t_n)+f_3(t_1-t_o)
$$
Όπου:

* $R_i$ η διαχωριστικότητα μεταξύ γειτονικών κορυφών
* Ν ο αριθμός κορυφών του χρωματογραφήματος
* $t_A$ ο επιθυμητός μέγιστος χρόνος ανάλυσης
* $t_n$ ο χρόνος έκλουσης του τελευταίου συστατικού
* $t_1$ ο χρόνους έκλουσης του τελευταίου συστατικού
* $t_o$ ο νεκρός χρόνος (χρόνος έκλουσης διαλύτη)
* $f_1,f_2,f_3$ εμπειρικοί συντελεστές βαρύτητας και εξομάλυνσης
  
//Εικόνες

Υπάρχουν και άλλες παραλλαγές του αλγορίθμου αν και σπανίως χρησιμοποιούνται:

* Υπερτροποποιημένη Simplex
* Simplex με ζυγισμένο κεντροειδές
* Simplex ελεγχόμενου ζυγισμένου κεντροειδούς
* Simplex με ζυγισμένο κεντροειδές και ορθογώνια επέκταση
* Simplex με ελεγχόμενη συμμετρία


  